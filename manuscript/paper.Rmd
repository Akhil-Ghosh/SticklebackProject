---
title: |
  |  \Large Increased sexual dimorphism does not evolve in a fossil stickleback following ecological release from fish piscivores
author: | 
  | \large Matthew Stuart$^{1,2}$, Allison Ozark$^{3}$, Raheyma Siddiqui$^3$, Akhil Ghosh$^{1,2}$
  | \large Samantha Swank$^3$, Michael A. Bell$^4$, Gregory J. Matthews$^{1,2}$, and Yoel E. Stuart$^{3,+}$ 
  | \vspace{-1.1mm}
  | \large $^1$ Department of Mathematics and Statistics, Loyola University Chicago, Chicago, IL, USA \vspace{-1.1mm}
  | \large $^2$ Center for Data Science and Consulting, Loyola University Chicago, Chicago, IL, USA \vspace{-1.1mm}
  | \large $^3$ Department of Biology, Loyola University Chicago, Chicago, IL, USA \vspace{-1.1mm}
  | \large $^4$ University of California Museum of Paleontology, Berkeley, CA, USA \vspace{-1.1mm}
  | \large $^+$ Corresponding: ystuart@luc.edu \vspace{-1.1mm}
abstract: |
  | Theory suggests that populations should expand their habitat- and resource-use niches when they are freed from interactions with competitors and predators--so-called ecological release. One way that this ecological release can manifest is through increased differences between males and females of the same species as they diverge into different niches. If divergent niche use drives corresponding divergent adaptation in in the traits used to exploit the divergent niches, then theory predicts an increase in sexual dimorphism for those traits, sometimes called character displacement between the sexes. Using a dataset of 16 traits collected from 18 temporal samples spread across 16,500 years of evolution of the fossil stickleback fish, *Gasterosteus doryssus*, we tested the prediction that release from predation inferred in this system would result in character displacement between the sexes. We used data from populations of extant stickleback (*Gasterosteus aculeatus*) to build an imputation model to classify individual sex in fossil specimens. Then, we quantified the extent of sexual dimorphism at each temporal sample, and tracked how it changed through time. NEED TO FINISH THIS   \vspace{2mm}
  | *Keywords*: character displacement, character release, evolutionary time series, *Gasterosteus doryssus*, missing data imputation
bibliography: references.bib
fontsize: 12pt
link-citations: true
linkcolor: cyan
urlcolor: cyan
output:
  pdf_document:
    df_print: kable
    number_sections: true
    keep_tex: true
header-includes:
 \usepackage{setspace}
 \setstretch{1.15}
 \usepackage{float}
 \floatplacement{figure}{t}
---

```{r setup, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	fig.align = "center",
	message = FALSE,
	warning = FALSE
)

gjm <- function(x, color = "red") {
  sprintf("\\textcolor{%s}{%s}", color, x)}
```

\newcommand{\iid}{\overset{iid}{\sim}}

```{r pkgs}
library(tidyverse)
theme_set(theme_minimal())
library(Lahman)
library(bookdown)
```

\newpage

# Introduction {#sec:intro}

Ecological release theory suggests that a population’s niche should change when important species interactions like resource competition or predation are relaxed or removed (reviewed in @Herrmannetal2021). Removal is posited to create ecological opportunity—i.e., aspects of the niche become newly accessible, and the focal population shifts and/or expands its resource use new resources (@ParentandCrespi2009; @Herrmannetal2021). Ecological release may then be followed by adaptive morphological evolution as traits change to reflect the new niche (@ParentandCrespi2009; @Herrmannetal2021).

For example, a population undergoing ecological release can experience disruptive selection on males and females stemming from intraspecific competition over newly accessible resources (@BolnickandDoebeli2003; @BolnickandLau2008; @Cooperetal2011). This is predicted to result in intersexual divergence in habitat use and associated phenotypes (@Schoener1968; @Shine1989; @BolnickandDoebeli2003; @Butleretal2007; @BolnickandLau2008; @Cooperetal2011; but see @Stuartetal2021; @Blain2022). Such competition-driven “intraspecific character displacement” between the sexes is therefore one explanation for the evolution of sexual dimorphism (@PfennigandPfennig2012; @DeLisleandRowe2015; @DeLisleandRowe2017, @DeLisleetal2018). 

Much of the theory and empirical data for character displacement between the sexes is based on release from resource competition specifically (e.g., @BolnickandDoebeli2003; @Cooperetal2011; @PfennigandPfennig2012; @DeLisleandRowe2015; @DeLisleetal2018). However, release from predation might also drive the evolution of increased sexual dimorphism because an absence of predators should generate ecological opportunity (@ReimchenandNosil2004; @ParentandCrespi2009; @Herrmannetal2021). 

Here, we tested the prediction that a release from predation results in the evolution of increased sexual dimorphism using a well-preserved, finely-resolved sequence of a fossil threespine stickleback fish (Gasterosteus doryssus). The sequence in this depositional environment is comprised of two lineages (@Bell2009; @Cerasonietal2024). Lineage I was a low-armor form with zero to one dorsal spines and highly reduced pelvises, on average. Lineage I lasted for at least 93,000 years before it was replaced by a second lineage, suddenly, likely on the order of years (@Belletal1985; Stuart et al. unpublished data). Lineage II appeared in the depositional environment fully armored, with complete pelvic girdles, two pelvic spines, and three dorsal spines (@Belletal2006; @Stuartetal2020). It then immediately began evolving adaptive reduction in its armor traits (@Huntetal2008; @Stuartetal2020) until it reached the same low-armor state previously held by lineage I. 

The observation of 93,000 years of low-armor stasis in lineage I (@Belletal1985) and the observation of rapid evolution of armor loss by lineage II, both suggest that this depositional environment lacked piscivorous fish like trout and other salmonids known to prey on modern threespine stickleback. Armor presence in extant threespine stickleback (Gasterosteus aculeatus) correlates strongly with the presence of vertebrate piscivores; populations with less predation pressure typically have less armor (@Reimchen1994, @ReimchenandNosil2004; @Belletal1993; @Roestietal2023). In our paleolake basin, only three fossil trout have been found in the same section of rock that has revealed >20,000 threespine stickleback fossils as well as occasional killifish (Fundulus nevadensis) (@Bell2009; @Cerasonietal2024).  Thus, we reconstruct an evolutionar history in which it is likely that lineage II migrated from a nearby paleolake basin that had predators since it was armored when it arrived (@Bell2009; @Cerasonietal2024). Lineage II then experienced release from predators in the focal paleolake basin, generating the initial conditions of evolutionary models predicting the evolution of increased sexual dimorphism following ecological release. We test this prediction here. 

A major challenge in the study of fossilized sexual dimorphism is assigning sex to individual specimens in the first place (@HoneandMallon2017; @Mallon2017; @Saittaetal2020). This typically cannot be done directly, except for taxa whose sexes are distinguished by the presence or absence of sex-specific characters that preserve well. Instead, paleobiologists often resort to statistical detection of sex and sexual dimorphism, including tests for normality and bimodality in trait distributions (e.g., @Mallon2017), mixture modeling (e.g., @Mallon2017), divergence in growth curves (e.g., @Saittaetal2020), and emphasis on effect size statistics rather than significance testing (e.g., @Saittaetal2020). However, dimorphic signal can be masked by noise introduced by factors both biological and artifactual, including extended growth during ontogeny, age-based bias in survivorship, small sample sizes, time averaging, and taphonomic bias (@Godfreyetal1993; @KoscinskiandPietraszewski2004; @HoneandMallon2017; reviewed in @Mallon2017; reviewed in @Saittaetal2020). Thus, the best approach to sex classification is likely one of total evidence (@Saittaetal2020), including comparison to closely-related, extant species of known sex (e.g., @HoneandMallon2017; @Saittaetal2020).

For our study, we inferred sex in G. doryssus fossils by comparing multivariate morphological trait data from lineage II samples to the same multivariate trait set collected from multiple populations in the closely-related, extant Threespine Stickleback species complex (Gasterosteus aculeatus). Crucially, we determined G. aculeatus sex directly via dissection and/or PCR genotyping. This enabled us to use Multiple Imputation by Chained Equations (MICE; @MICE) to build a predictive multiple imputation algorithm (@little2002statistical) based on the multivariate morphology of G. aculeatus individuals of known sex. We applied this algorithm to the fossil data to impute individual sex based on morphology, treating fossil sex as a missing variable. With sex assigned to fossil specimens, we fit a modified Ornstein-Uhlenbeck (OU) (@OUProcess) model using a Bayesian framework that accounts for uncertainty in sex classification to test for evolution of sexual dimorphism in each trait over ~16,000 years of lineage II.

# Data {#sec:data}
```{r}
library(tidyverse)
stickle <- read_csv('stickle_revamped.csv')

stick <- stickle %>% 
  mutate(gender = as.factor(case_when(
    grepl(".M.",univID,fixed=TRUE) ~ "Male",
    grepl(".F.",univID,fixed=TRUE) ~ "Female",
    grepl("Fos",univID,fixed=TRUE) ~ NA_character_
    )), ips = as.factor(ips)
  ) %>% 
  select(gender, everything())

#getting time vector, adding it to imputed data
univ <- stick %>% 
  mutate(time = as.integer(sub(".*([0-9]{2})\\..*", "\\1",univID)))
times <- univ %>% drop_na(time) %>% pull(time)

times_vector <- c(rep(1,43)) %>% 
  append(21-times)

#fossil n
#fortab <- data.frame(time = 1:18, count = as.character(as.numeric((table(times_vector)))))
fortab <- data.frame(time = 1:18, count = as.numeric((table(times_vector))))
#knitr::kable(fortab)
#print(xtable(fortab),include.rownames = FALSE)
```

## Fossil Specimen Data
We used Gasterosteus doryssus data that were previously reported by @Stuartetal2020, @Vojeetal2022, and @Siddiquietal2024. Briefly, the data were collected from fossil Series K from Quarry D (@Cerasonietal2024), dug from an open pit diatomite mine at 9.526° N, 119.094° W, near Hazen, Nevada, USA. Series K consisted of 18 samples taken at ~1000-year intervals, and mean sample times span ~16,363 years. Fish from series K were measured for 16 ecomorphological traits related to armor, swimming, and feeding (Table 1). Series K started at the previously documented horizon when lineage I was replaced by lineage II. The tempo and mode of lineage II armor reduction during this sequence suggests adaptive evolution by natural selection (@Huntetal2008), and we focus on the multivariate evolution of sexual dimorphism by this second lineage.

The lineage II fossil data consist of `r sum(is.na(stick$gender))` specimens of unknown sex sampled across the 18 K series samples. Figure 1 shows the sample size for each of the 18 samples.  There are at least 22 specimens in each sample with a high of 67 specimens in sample 7.  


| Trait Name  | Trait Code | Trait Description           |
|------------|-----|------------------------------------------|
|Standard Length|	`stl` |	Distance from anterior tip of premaxilla to posterior end of last vertebra (i.e., the llhypural plate)|
|Dorsal Spine Count| `mds` |	Number of dorsal spines|
|Dorsal Fin Ray Count|`mdf`|	Number of bones in the dorsal fin posterior to the third dorsal spine (i.e., soft dorsal fin rays)
|Anal Fin Ray Count|`maf`|	Number of bones in the anal fin posterior to the anal spine (i.e., soft anal fin rays)|
|Abdominal Vertebra Count|`mav`|	Number of vertebrae anterior to the first vertebra contacting an anal fin pterygiophore (Aguirre et al. 2014)|
|Caudal Vertebra Count|`mcv`	| Vertebrae including and posterior to the first that contacts an anal fin pterygiophore (Aguirre et al. 2014)|
|Pterygiophore Count|`mpt`|	Number of pterygiophores anterior to but excluding the pterygiophore under the third dorsal spine|
|Pelvic Spine Length|`lps.sc`	|Length from the base of one pelvic spine at its pelvic girdle articulation to its distal tip|
|Ectocoracoid Length|`ect.sc`|	Length from the anterior to posterior tips of the shoulder girdle base|
|Pelvic Girdle Length|`tpg.sc`|	Length from the anterior to posterior tips along midline. If vestigial, the sum of longest axis along vestiges|
|Cleithrum Length|`cle.sc`|	Length from dorsal tip to ventral tip on the anterior margin of the shoulder girdle|
|Premaxilla Length|`pmx.sc`|	Length from the anterior tip of the premaxilla to the distal tip of its ascending process|
|Dorsal Spine Length|`Ds#.sc #=1/2/3`|	Length from the dorsal spine base at the pterygiophore to its distal tip|
|Pterygiophore Length|`lpt.sc`|	Distance from anterior to posterior edges of the pterygiophore immediately before ds3 (when present)|

\textcolor{red}{This table caption should be part of the table. Top row. at the very least, it should be the width of the table. -YS}
Table: Traits and trait descriptions. ‘sc’ denotes size correction of trait against standard length. Names of bones follow @Bowne1994 unless otherwise noted.

## Extant Specimen data
To span the gamut of stickleback diversity for our predictive imputation model, we sampled modern stickleback from lakes containing generalist stickleback populations (@Hendryetal2009; @Bolnick2011) and from lakes containing benthic-limnetic species pairs (@Baumgartneretal1988; @SchluterandMcPhail1992). The generalist specimens used here were collected by YES in 2013 and were previously described in @Stuartetal2017 (Table S1). These samples were fixed in formalin, then stained for bone with Alizarin Red in 2013. Benthic and limnetic specimens were kindly loaned by D. Schluter and S. Blain at the University of British Columbia. The Schluter lab collected benthic and limnetic individuals from Enos Lake in 1988 and from Emily Lake, Little Quarry Lake, Paxton Lake, and Priest Lake in 2018 (Table S1). The Enos specimens had been fixed whole in formalin and stored in 40% isopropanol. The specimens from the other lakes were initially preserved whole in 95% ethanol in the field before being gradually transferred to water then formalin in the lab and ultimately stored in 40% isopropanol. In 2019, we stained these specimens for bone using Alizarin Red.

We next replicated fossil data collection (Table 1) on these extant specimens. Standard length as well as pelvic-spine length on each side were measured with calipers. We used a dissection microscope to count dorsal spines, pelvic spines, dorsal-fin rays, and anal-fin rays. Right and left-side pelvic girdle lengths and ectocoracoid lengths were measured from ventral photographs taken using a Canon EOS Rebel T7 with a Tamron 16-300 mm MACRO lens mounted on a leveled Kaiser RS1 copy stand. Specimens were held in place for ventral photographs using a small tabletop vise with an attached scale bar. Lateral X-rays were used to measure dorsal spine length, number of pterygiophores anterior to the pterygiophore holding the third spine, length of the pterygiophore just anterior to the third spine, cleithrum length, and pre-maxilla ascending branch length. We also counted vertebrae from the X-rays: abdominal vertebrae were counted anterior to the first vertebra with a haemal spine contacting an anal fin pterygiophore. Caudal vertebrae were posterior, including the first vertebra with the haemal spine contacting the anal fin pterygiophore (following @Aguirreetal2014). X-rays were taken with an AXR Hot Shot X-ray Machine (Associated X-ray Corporation) at the Field Museum of Natural History. Specimens were exposed at 35kV and 4mA. Small fish were exposed for 7s, medium fish for 8s, and large fish for 10s. We developed the film and scanned individual images of each fish using the B&W Negatives setting on an Epson Perfection 4990 Photo flatbed at 2400 dpi. Measurements from photographs and X-rays were taken with FIJI (@Schindelinetal2012) and its plugin ObjectJ (https://sils.fnwi.uva.nl/bcb/objectj/). We dissected individuals from the generalist populations (Table S1) to determine sex from the gonads. Individuals from the species-pair lakes (TableS1) were previously sexed by the Schluter lab, using either dissection or a genotyping protocol \textcolor{red}{(Whom, personal communication)}.

## Outlier analysis and size correction. 
To check for outliers, we calculated within-group means and standard deviations for each trait separately for K series fossil specimens (pooled across samples) and for extant specimens (within generalist, benthic, or limnetic categories). We noted trait values greater than 3.0 standard deviations from the mean as potential outliers. We deemed 3.0 s.d. to be a reasonable threshold for detecting errors without excluding biologically relevant values. We checked whether these potential outliers were a result of data entry and collection error and corrected them if they were. We turned the remaining outlier trait values to NAs. We size-corrected continuous traits only, as they varied with size, unlike count traits that are fixed during early development. We regressed each trait on standard length using a mixed-model regression, pooling all specimens, following @Stuartetal2017. We appended the size corrected data to the uncorrected trait data frame and used all of our data (raw and size-corrected) to build the imputation model described next.

## Missing data imputation, including fossil sex
Briefly, we used multiple imputation (@little2002statistical) to impute the sex of the fossils. Let $\boldsymbol{W}$ be an $(n_{extant} + n_{fossil}) \times 1$ vector of the covariate sex of the stickleback fish and $\boldsymbol{Y}$ be an $(n_{extant} + n_{fossil}) \times K$ matrix of the $K$ phenotypes of interest.  Because the sex of the fossilized stickleback fish is unobservable, we further define $\boldsymbol{W} = (\boldsymbol{W}_{extant}^T,\boldsymbol{W}_{fossil}^T)^T$ where $\boldsymbol{W}_{extant}$ and $\boldsymbol{W}_{fossil}$ are the $n_{extant} \times 1$ and $n_{fossil} \times 1$ vectors of the observed extant sex and missing fossil sex, respectively. We imputed missing sex for the fossil data by sampling from the posterior predictive distribution $P(\boldsymbol{W}_{fossil}|\boldsymbol{W}_{extant},\boldsymbol{Y})$ using the multiple imputation by chained equations (MICE) algorithm (@MICE) with predictive mean matching, implemented in R (CITATION).  Traditionally, the choice for the number of completed dats sets is a relatively small number such as $M = 5$ or $M = 10$.  However, @ZhouReiter2010 recommend a larger number of imputed data sets if users intend on performing Bayesian analysis after imputation.  Therefore, we imputed $M = 100$ complete datasets. 
\textcolor{red}{Greg, PRESUMABLY this also imputes missing data in the other traits? We should probably say that explicitly. -YS}
\textcolor{red}{Greg, AKHIL'S METHODS FOR VALIDATION OF THE IMPUTATION MODEL GOES HERE}

We then pooled all of the draws from the posterior distribution across all the imputed data sets to estimate the posterior distributions of our parameters of interest (i.e., the trait values), rather than using Rubin's combining rules, following @ZhouReiter2010. We then dropped extant fish from our imputed data sets and used these posterior distributions in our downstream analyses of fossil sexual dimorphism. 

## Modeling fossil stickleback trait means through time for males and females
 The goal of our analysis was to model fossil trait means through time, by sex, while incorporating uncertainty across imputations in the classification of sex. We therefore implemented a Bayesian hierarchical model structure (described below) to account for classfication uncertainty and the fact that the rate of change of any one trait mean over time may be a non-constant value. 

To estimate fossil sample means through time, for a given imputed dataset, we let $W_{ij}$ be the imputed sex and $\boldsymbol{Y}_{ij}$ be the $K \times 1$ vector of phenotypes for stickleback fossil $j$ at time $t_i$ where $i = 1, \ldots, T$ and $j = 1,\ldots,n_{t}$.  In addition, we denote $Y_{K,ij}$, the last variable in $\boldsymbol{Y}_{ij}$, to be the standard length of each fish individual, a measure of body size.
\begin{align}
{Y}_{K,ij} & \iid \left\{\begin{array}{lll} \mathcal{N}(\mu_{K,ft_i},&\sigma_{K}^2), & W_{ij} = \text{Female} \\ \mathcal{N}(\mu_{K,mt_i},&\sigma_{K}^2), & W_{ij} = \text{Male} \end{array}\right..
\label{eq:stl}
\end{align}

Continuous traits will likely have some correlation with standard length (i.e., allometry) (@Huxley1932)(@Vojeetal2022)(@Vojeetal2014). We account for this by adding an additional parameter, $\gamma_k$. In addition, the continuous traits ds1, ds2, ds3, lps, tpg are notable because they tend to be lost during the evolution of armor reduction in this system (@Belletal1985, @Stuartetal2020). This generates meaningful zeros for trait lengths in our empirical dataset that violate model assumptions. Therefore, for these random variables, we added the binary variable $Z_{ij}$, where $Z_{k,ij} = 1$ means that the trait is lost, and $Z_{k,ij} = 0$ means the trait is observed. For all other continuous traits, we assume $Z_{k,ij} = 0$ <!--We also define $Y_{k,ij}$ as -->

<!-- \begin{align} -->
<!-- {Y}_{k,ij} & = \left\{\begin{array}{llll} Y_{k,ij} & Z_{k,ij} = 0 \\ 0 & Z_{k,ij} = 1 \end{array}\right. -->
<!-- \end{align} -->

If $Y_{k,ij}$ is a continuous trait, then, potentially conditioning on $Z_{k,ij} = 0$, 
\begin{align}
{Y}_{k,ij} & \iid \left\{\begin{array}{llll} \mathcal{N}(\mu_{k,ft_i} + \gamma_kY_{K,ij},\sigma_k^2), & W_{ij} = \text{Female} \\ \mathcal{N}(\mu_{k,mt_i} + \gamma_kY_{K,ij},\sigma_k^2), & W_{ij} = \text{Male} \end{array}\right..
\label{eq:cont}
\end{align}
In other words, (\ref{eq:cont}) only considers the subset of fossils where the given trait is present when performing a data analysis. For the traits with potential loss, we model the $Z_{k,ij}$ via a $Bernoulli(p_{k,ij})$ distribution where
\begin{align}
\text{logit}({p}_{k,ij}) & = \left\{\begin{array}{llll} \alpha_{k,ft_i} + \beta_kY_{K,ij} & W_{ij} = \text{Female} \\ \alpha_{k,mt_i} + \beta_kY_{K,ij}, & W_{ij} = \text{Male} \end{array}\right.,
\label{eq:cont_prob}
\end{align}
and logit is a function to convert the probability to the log-odds, to allow for easier modelling of linear techniques while still ensuring any probability predictions are guaranteed to be between 0 and 1. Modeling traits this way allows us to first estimate the probability of trait loss for an individual at a given time, and ask if the sexes differ in their tendency toward loss through time. Then, for individuals that have not lost the trait, we can estimate trait values and calculate sexual dimorphism through time. 

If $Y_{k,ij}$ is a discrete trait, the conventional modelling method is to fit a Poisson distribution. However, the empirical fossil data violate the assumption that the Poisson variance is equal to its mean, so we fitted discrete traits to a generalized Poisson model (@GeneralizedPoisson). Specifically, if $X \sim GP(\lambda,\alpha)$, then 
\begin{align}
P(X = x) = \left\{\begin{array}{cc} \frac{(1 - \alpha)\lambda[(1 - \alpha)\lambda + \alpha x]^{x - 1} \exp\left\{-((1 - \alpha)\lambda  + \alpha x)\right\}}{x!} & (1 - \alpha)\lambda  + \alpha x \geq 0  \\ 0 & (1 - \alpha)\lambda  + \alpha x < 0 \end{array}\right.,
\label{eq:GP_pmf}
\end{align}
where GP denotes a generalized Poisson distribution with $E(X) = \lambda$ and $Var(X) = \frac{\lambda}{(1 - \alpha)^2}$.

In addition, we modeled two discrete traits, abdominal vertebrae number (mav) and caudal vertebrae number (mcv) to vary with standard length. This is because these are vertebral counts that made along the anterior-posterior access of the fish; these vertebrae contribute to the length of the fish directly and may evolve in a correlated fashion. If $Y_{k,ij}$ is one of the above traits, then
\begin{align}
{Y}_{k,ij} & \sim \left\{\begin{array}{ll} GP(\lambda_{k,ft_i} = \exp\{\mu_{k,ft_i} + \gamma_kY_{K,ij}\},\alpha_k), & W_{ij} = \text{Female} \\ GP(\lambda_{k,mt_i} = \exp\{\mu_{k,mt_i} + \gamma_kY_{K,ij}\},\alpha_k), & W_{ij} = \text{Male} \end{array}\right..
\label{eq:disc_corr}
\end{align}

For the other discrete counting traits, we set $\gamma_k = 0$ because we expect that trait counts are set during early ontogeny and should not change with size in adult fish. Thus,
\begin{align}
{Y}_{k,ij} & \sim \left\{\begin{array}{ll} GP(\lambda_{k,ft_i} = \exp\{\mu_{k,ft_i}\},\alpha_k), & W_{ij} = \text{Female} \\ GP(\lambda_{k,mt_i} = \exp\{\mu_{k,mt_i}\},\alpha_k), & W_{ij} = \text{Male} \end{array}\right..
\label{eq:disc_ind}
\end{align}
We point out that counting trait means are represented by $\exp\{\mu_{k,ft_i}\}$ and $\exp\{\mu_{k,mt_i}\}$. This distinction helps in our modelling procedure because $\mu_{k,ft_i}$ and $\mu_{k,mt_i}$ are represented on the real number line. This allows for easier modelling by linear techniques, and that any mean for the discrete traits is strictly positive. In addition, to ensure proper sampling from our posterior distribution of interest, we transform $\phi_k = \log\left(\frac{\alpha_k - \max_{i,j}(-\lambda_{k,ij}/y_{k,ij})}{1 - \alpha_k}\right)$ where $\lambda_{k,ij} = \left\{\begin{array}{cc} \exp(\mu_{k,ft_i} + \gamma_k Y_{K,ij}) & W_{ij} = \text{Female} \\ \exp(\mu_{k,mt_i} + \gamma_k Y_{K,ij}) & W_{ij} = \text{Male} \end{array}\right.$.

<!-- In the above model descriptions, $\mu_{k,ft_i}$ and $\mu_{k,mt_i}$ model the time-$t_i$, sample-specific (potentially log-transformed) trait mean $k$ for females and males, respectively. -->  To account for the possibility that there is a time-dependent (i.e., evolutionary trend) trend in $\mu_{k,ft_i}$ and $\mu_{k,mt_i}$, we further set
\begin{align}
\mu_{k,gt_i} = \beta_{0,kg} + \beta_{1,kg}t_i + u_{k,gt_i},
\label{eq:mu}
\end{align}
for $g \in \{f,m\}$, where $\beta_{0,kg}$ and $\beta_{1,kg}$ are regression parameters of phenotype $Y_k$ for each sex, and $u_{k,gt_i}$ is the corresponding residual. For the continuous phenotypes with potential lost trait values, we model $\alpha{k,gt_i}$ in (\ref{eq:cont_prob}) by
\begin{align}
\alpha_{k,gt_i} = \beta_{0,p,kg} + \beta_{1,p,kg}t_i + u_{k,p,gt_i}.
\label{eq:prob}
\end{align}
For convenience, we drop the subscript $p$ for all model descriptions to come, and assume same modelling techniques apply. To account for potential correlations between the residuals for a given trait $k$ and sex $g$, we fit an Ornstein-Uhlenback (OU) process (@OUProcess). More specifically, we defined $du_{k,gt} = u_{k,g(t + dt)} - u_{k,gt}$, the change in $u_k,gt$ for a given trait $k$ and sex $g$ over a miniscule time period $dt$. The OU process is defined as 
\begin{align}
du_{k,gt} = -\kappa_k u_{k,gt} dt + \tau_k dW_t,
\label{eq:OU_cont}
\end{align}
where $\kappa_k$ is a parameter associated with the correlation between $u_{k,gt}$ and $u_{k,g(t+dt)}$, $\tau_k$ is the standard deviation of the OU process, and $W_t$ is a standard Brownian motion. As shown in @OUProcess, the closed form solution for the stochastic differential equation in (\ref{eq:OU_cont}) is
\begin{align}
u_{k,gt_i} \iid \mathcal{N}\left(u_{k,gt_{i-1}}\exp\{-\kappa_k(t_{i} - t_{i-1})\} , \frac{\tau_k^2(1 - \exp\{-2\kappa_k(t_{i} - t_{i-1}))\}}{2\kappa_k}\right)
\label{eq:OU_sol}
\end{align}
for $i = 2,\cdots,T$. In a traditional OU process, the initial value $u_{k,gt_1}$ is assumed to be a (potentially unknown) constant. This unknown constant can therefore be considered a latent variable, further justifying our Bayesian approach, which better incorporates prior information and uncertainty from missing data imputation in the estimate of latent variables.

We chose the following priors, designing them to be weakly informative such that the posterior distributions could be influenced by the data, if warranted. For $k = 1,\cdots,K$, 

\begin{align}
u_{k,gt_1} & \iid \mathcal{N}(0,\tau_{0,k}) \nonumber \\
\sigma_k & \iid \mathcal{N}(0,10)I_{\{\sigma > 0\}} \nonumber \\
\tau_k & \iid \mathcal{N}(0,10)I_{\{\tau > 0\}} \nonumber \\
\tau_{0,k} & \iid \mathcal{N}(0,20)I_{\{\tau > 0\}} \nonumber \\
\kappa_k & \iid \mathcal{N}(0,1)I_{\{\kappa_g > 0\}} \nonumber \\
\gamma_{k} & \iid \mathcal{N}(0,5) \nonumber \\
\beta_{0,kg} & \iid \mathcal{N}(0,100) \nonumber \\
\beta_{1,kg} & \iid \mathcal{N}(0,3) \nonumber \\
\label{eq:priors}
\end{align}

We also note that, for the discrete phenotypes in equations (\ref{eq:disc_corr}) and (\ref{eq:disc_ind}), there is no $\sigma_k$, and it is not sampled, and for the continuous phenotypes in equation (\ref{eq:cont}), there is no $\phi_k$ and it is not sampled.

We follow the method outlined in @ZhouReiter2010 to obtain $R$ draws from the posterior distributions of the model parameters given our observed data and imputed values. More specifically, for the $j^{th}$ imputed data set where $j = 1,\cdots,M$, we obtain $\frac{R}{M}$ draws from the posterior distribution using an MCMC algorithm with a sufficient burnin period, and then we combine these $M$ MCMC draws to say that we have a total of $R$ draws from the overall posterior distribution of interest. 

<!-- For the continuous phenotypes, the mean trait sizes for each sex $\mu_{k,m,t_i}$ and $\mu_{k,f,t_i}$ are calculated using (\ref{eq:mu}).For the discrete phenotypes, equations (\ref{eq:disc_corr}) and (\ref{eq:disc_ind}) calculate the mean trait size is $\lambda_{k,m,t_i} = \exp(\mu_{k,m,t_i})$ and $\lambda_{k,f,t_i} = \exp(\mu_{k,f,t_i})$ for males and females. With posterior distributions of the model parameters described above, we obtained $R$ samples from the posterior distribution of mean trait values by trait for males and females at each time step. We then used these values to quantify the presence or absence of sexual dimorphism, and describe how sexual dimorphism evolved through time. -->

## Quantifying sexual dimorphism, and testing for increased sexual dimorphism through time.
We quantify sexual dimorphism at each time $t_i: i = 1,\cdots,T$ by calculating the difference in mean trait size for males and females at each time for a continuous phenotype, $SD_{k,t_i} = \mu_{k,m,t_i} - \mu_{k,f,t_i}$ and for a discrete phenotype $SD_{k,t_i} = \lambda_{k,m,t_i} - \lambda_{k,f,t_i}$. For simplicity, we will define sexual dimorphism for both continuous and discrete traits as $SD_{k,t_i} = \mu_{k,m,t_i} - \mu_{k,f,t_i}$. Because we are performing a Bayesian analysis, we do not obtain a single point estimate of sexual dimorphism at a particular time, but rather $R$ samples from the posterior distribution of sexual dimorphism given the observed fossil and extant data. Therefore, our analysis will be conducted by calculating $SD_{k,t_i,r} = \mu_{k,m,t_i,r} - \mu_{k,f,t_i,r}$ for $r = 1,\dots,R$ and then perfoming our data analysis on these samples. Presence (or absense) of sexual dimorphism for trait $k$ can be indicated by estimating the posterior probability of positive sexual dimorphism $P(SD_{k,t_i} > 0 | \boldsymbol{y}) = \frac{1}{R} \sum_{r=1}^R I(SD_{k,t_i,r} > 0)$. Figures \ref{fig:post_probs_armor} and \ref{fig:post_probs_nonarmor}  plot these posterior probabilities across time for each of the armored traits and non-armored traits, respectively. The closer the $P(SD_{k,t_i} > 0 | \boldsymbol{y})$ is to 1, the larger the evidence that the average trait size for males is larger than females, while if $P(SD_{k,t_i} > 0 | \boldsymbol{y})$ is close to 0, the larger the evidence that the average trait size for females is larger than males, both indicating strong presence of sexual dimorphism. On the contrary, $P(SD_{k,t_i} > 0 | \boldsymbol{y})$ around 0.5 indicates that the average trait size is roughly equivalent for both males and females, providing little evidence of dimorphism.

```{r, echo=FALSE, fig.align='center',fig.cap="Posterior probability of positive sexual dimorphism for armor traits"}
knitr::include_graphics("../Figures/SD_Figures/post_probs_armor.pdf")
```
\label{fig:post_probs_armor}

```{r, echo=FALSE, fig.align='center',fig.cap="Posterior probability of positive sexual dimorphism for non-armor traits"}
knitr::include_graphics("../Figures/SD_Figures/post_probs_nonarmor.pdf")
```
\label{fig:post_probs_nonarmor}

<!-- The presence of sexual dimorphism was indicated by... \textcolor{red}{Matt, can you help me with Bayesian the language here? I think this is the place to reference the two post probs plots, yes? Values far from fifty fifty indicate that the mass of the posterior distribution is away from a male female difference of zero. YS} -->

Then, to test our prediction that ecological release should result in an increase in sexual dimorphism through time, we calculated Kendall's $\tau$ coefficient for each trait (@KendallsTau). Kendall's $\tau$ assesses the ordinal association between a set of bivariate observations, where $\tau > 0$ indicates concordance between the observations (i.e., as $x$ increases, $y$ also tends to increase; here,$x$ is time and $y$ is sexual dimorphism.) Kendall's $\tau$ varies between -1 and 1, and can be thought of as behaving like a correlation. Values farther from zero indicate a stronger relationship.

$\boldsymbol{\tau}_k = \{\tau_{k,r}: r = 1,\cdots,R\}$ for trait $k$ where $\tau_r$ is the estimate of the Kendall's $\tau$ correlation for $\mu_{k,m,t_i} - \mu_{k,f,t_i}$ versus time $t_i$ for the $r^{th}$ MCMC sample from the posterior distribution. For each trait, a large proportion of values in $\boldsymbol{\tau}_k$ that are greater than 0 ($\frac{1}{R} \sum_{r=1}^R I(\tau_{k,r} > 0)$) may indicate that males have gotten relatively larger than females through time, indicating an increase in male-biased dimorphism through time. A large proportion of values in $\boldsymbol{\tau}_k$ that are less than 0 ($\frac{1}{R} \sum_{r=1}^R I(\tau_{k,r} < 0)$) may indicate that females have gotten relatively larger than males, indicating an increase in female-biased dimorphism through time.

# Results {#sec:results}
The extant data used here consist of a total of `r sum(!is.na(stick$gender))` specimens all with known sex (Table S1).  Of these, there are `r sum(stick$gender == "Female",na.rm = TRUE)` and `r sum(stick$gender == "Male",na.rm = TRUE)` female and male specimens, respectively. 

## Missing Data Imputation


```{r eval = FALSE}
library(mixgb)
library(mice)
library(tidyverse)
library(janitor)
library(missMethods)
library(ROCR)

stickle <- read_csv('../Data/Stickle_revamped.csv')

stick <- stickle %>% 
  mutate(gender = as.factor(case_when(
    grepl(".M.",univID,fixed=TRUE) ~ "Male",
    grepl(".F.",univID,fixed=TRUE) ~ "Female",
    grepl("Fos",univID,fixed=TRUE) ~ NA_character_
    )), ips = as.factor(ips)
  ) %>% 
  select(gender, everything())

stick

extant_stickle <- stick %>% filter(gender != "Fossil") %>% select(!univID)
extant_stickle
summary(extant_stickle)

M = 10
k = 5
stick_matrix <- matrix(NA, nrow=nrow(extant_stickle), ncol = M)
set.seed(12)
fold <- sample(1:k, size = nrow(extant_stickle), replace=TRUE)
for(i in 1:k){
extant_stickle_temp <- extant_stickle
extant_stickle_temp$gender[fold==i] <- NA
imputed_stick <- mice(extant_stickle_temp,m=M)
for(n in 1:M){
  
  complete_stick <- complete(imputed_stick, n)
  
  complete_stick$gender[fold==i]
  stick_matrix[fold==i, n] <- as.character(complete_stick$gender[fold==i])
}

}
pct_male <- apply(stick_matrix,1,function(x){
  mean(x == "Male")
})

imptest <- data_frame(truth = as.factor(extant_stickle$gender), pct_male)
save(imptest, file = "./Data/imptest.RData")
roc_pred <- prediction(imptest$pct_male, imptest$truth)

auc_rocr <- performance(roc_pred, measure="auc")
plot(performance(roc_pred, measure="tpr", x.measure="fpr"))

auc_rocr@y.values[[1]]

```

```{r}
load("./Data/imptest.RData")
library(ROCR)
library(tidyverse)
roc_pred <- prediction(imptest$pct_male, imptest$truth)

auc_rocr <- performance(roc_pred, measure="auc")
perf <- performance(roc_pred, measure="tpr", x.measure="fpr")
dat <- data.frame(fpr = perf@x.values[[1]], tpr = perf@y.values[[1]])
```

```{r fig.cap = "Reciver-Operating Characteristic Curve comparing imputed sex to actual sex for the extant cases using 5-fold cross validation (AUC = 0.831)"}
ggplot(aes(x = fpr, y = tpr), data = dat) + geom_path() + theme_bw() + xlab("False Positive Rate") + ylab("True Positive Rate") + geom_abline(slope = 1, lty = 2, color = rgb(0,0,0,0.2)) + coord_fixed()
```

<!-- While sex is observed for extant fish, the sex for fossil specimen cannot be observed.  Therefore, we turn to multiple imputation to fill in missing values of sex of fossil specimen using the observed extant fish cases.  In addition to missing sex for all of the fossil cases, there are several other cases of missing data in some variables in the fossil data, and those are imputed at the same time as sex is imputed.   -->

In order to test the efficacy of imputing sex in the fossil data, we performed 5-fold cross validation using only the extant cases. For each fold, the missing values, most notably sex, were imputed $M = 5$ times.  These imputations were then combined to estimate the probability of male vs female and an ROC curve was computed to evaluate the accuracy of the imputations.  The AUC was computed to be `r auc_rocr@y.values[[1]]`, indicating a good performance in estimating the probability of a fish being male/female.  


<!-- total sampel size1181 -->
<!-- fossils 814 -->
<!-- extant 367 -->

```{r echo = FALSE, fig.cap = "Density estimate of the percentage of specimen that were imputted to be male across the M = 100 imputations"}
#Summaries
dat <- read.csv("../Data/updated_stickle_imputations_100.csv")
dat %>% group_by(imp) %>% summarize(pct = 100*mean(gender == "Male")) %>% ggplot(aes(x = pct)) + geom_density() + theme_bw()
```

```{r echo = FALSE}
meanpct <- dat %>% group_by(imp) %>% summarize(pct = 100*mean(gender == "Male")) %>% ungroup() %>% summarize(pct = mean(pct))
sdpct <- dat %>% group_by(imp) %>% summarize(pct = 100*mean(gender == "Male")) %>% ungroup() %>% summarize(sd = sd(pct))

min <- dat %>% group_by(imp) %>% summarize(pct = 100*mean(gender == "Male")) %>% ungroup() %>% summarize(sd = min(pct))
max <- dat %>% group_by(imp) %>% summarize(pct = 100*mean(gender == "Male")) %>% ungroup() %>% summarize(sd = min(pct))

dat %>% group_by(imp) %>% summarize(pct = sum(gender == "Male") == sum(gender == "Female")) %>% ungroup() %>% summarize(pct = mean(pct))

```

Across the 100 imputations of the 814 fossil specimen, the average percentage of males in an imputation was `r paste0(round(meanpct$pct,2),"%")` with a standard deviation of `r paste0(round(sdpct$sd,2),"%")` ranging from `r paste0(round(min$sd,2),"%")` to `r paste0(round(max$sd,2),"%")`.  In only 31 of the 100 imputations were there more males than females with the remaining 69 imputations having exactly the same number or more females.  

\textcolor{red}{Yoel, I think I remember you talking about a reason why it made more sense that there were fewer males in the sample tham the females, but I don't remember the details.  Am I remembering this correctly?  Would be nice to add something here about that and say why these imputations are consistent with that.  
-GJM}

<!-- If we want to compute fraction of missing information.  This also computes imputed means.  -->
```{r echo = FALSE}
greg <- function(x){
dat %>% group_by(imp) %>% summarize(mean = mean(.data[[x]]), var = var(.data[[x]]))  %>% summarize(Q = mean(mean),  W = mean(var), B = var(var)) %>% mutate(Tm = (1+1/100)*B + W, lambda = (1+1/100)*B/Tm, se= sqrt(Tm))
}
data.frame(var = names(dat)[4:28],do.call(rbind,lapply(as.list(names(dat)[4:28]),greg))) %>% select(var, Q, se, lambda)

#Fraction of missing information
# Raghunathan, T. 2016. Missing Data Analysis in Practice. Boca Raton, FL: Boca Raton: CRC Press.
# Van Buuren, S. 2018. Flexible Imputation of Missing Data. Second Edition. Boca Raton, FL: Chapman & Hall/CRC.
```



\textcolor{red}{Greg, WE NEED RESULTS SECTION DESCRIBING THE RESULTS OF AKHIL'S MULTIPLE IMPUTATION, BOTH THE TESTS OF HOW WELL THE MODEL WORKED CLASSIFYING MODEL SAMPLES, AND SUMMARY STATISTICS OF FOSSIL IMPUTATION RESULTS -YS}


## Sexual Dimorphism 
Table \ref{tab:prob0-table} shows the posterior probability of the differences in the means between male and female specimens at each time point.  Probabilities near 0.5 indicate very little difference in the means whereas probabilities far from 0.5 indicate sexual dimorphism with values of 0 and 1 indicating larger mean values for females and males, respectively.  These results are shown graphically in figure \ref{fig:prob0-plot}. 

Figure \ref{fig:mu-diff-plot} shows the posterior mean difference for males versus females (values above 0 indicate means that were greater for males versus females).  The full posterior distributions over time for all traits are shown in the appendix.  


## Changes over time
We estimated the change in sexual dimorphism over time by calculating the distribution of Kendall's Tau for each trait. Here, positive values of Tau indicate that sexual dimorphism (defined as male means minus female means) increased through time. Average Tau values ranged from X to Y across traits and the proportion of positive area under the curve ranged from Z to W (Table Tau). Distributions are available for each trait in the Supplementary Material (Figures SX-SX+15). In Figure (Tau), we show representative distributions. For example, 

Something about the probability of dimorphim in the probability of loss? I.e., the prob_zero plots. For example, ds2_prob_zero has lots of positive area under the curve indicating that the rate of loss in males and females diverged, such that males were more likely to lose ds2 through time. Interestingly, for the individuals that kept their spines, dimorphism increased, with females getting larger than males (or males getting smaller than females). 



We can also assess the strength of the dimorphism by calculating the proportion of posterior samples that are greater than a prespecified threshold \textcolor{red}{(0.5??, idk what this could be.) -MS}

<!-- Table \ref{tab:auc-table} shows the probability that the posterior distribution of the differences in the mean is greater than the posterior distribution of the differences at the first time point.  Values near 0.5 indicate very little difference between the distributions whereas values closer to 0 and 1 indicate changes in the distributions with values of 1 meaning the difference in means has shifted towards males having a larger mean and values of 0 indicating the difference in means has shifted towards larger means in females.  These results are shown graphically in figure \ref{fig:AUC-plot}. -->


# Discussion, Future work and conclusions {#sec:conclusions}
We predicted that release from predators would result in niche expansion and increased sexual dimorphism, based on several studies of modern stickleback. For example, in lakes where sculpin competitors are absent and stickleback (Roesti et al. 2023)
See Spoljaric and Reimchen 2008, page 512 right column for references and discussion of differences between benthic males and limnetic females. Male stickleback are benthic and littoral (Wootton 1976)…. Reimchen papers in general good for this section.
Moreover, tooth wear data from the lineage II sequence suggest that individuals in this lineage began eating more planktonic prey over time, expanding toward an open-water niche from the benthic, bottom-feeding niche they started with (Purnell et al. 2007). That this expansion into open water by lineage II coincided with armor reduction is further indicative of a limnetic system with fewer salmonid piscivores (@SchluterandMcPhail1992; @VamosiandSchluter2004; @Roestietal2023).

# Acknowledgements {#sec:acknowl}

We thank O. Abughoush, S. Blain, A. Chaudhary, M. Islam, F. Joaquin, C. Lawson-Weinert, R. Sullivan, J. Tien, M.P. Travis, and W. Shim for help with data collection. We thank D. Schluter and S. Blain for loaning specimens and sharing data. We thank K. Swagel and C. McMahan of the Field Museum for assistance with specimen x-rays. This research was supported by NSF grants BSR-8111013, EAR-9870337, and DEB-0322818, the Center for Field Research (Earthwatch), and the National Geographic Society (2869-84) to MAB. It was also supported by NSF grants DEB-1456462 and EAR-2145830 to YES.  And NSF DMS-2015374 (GJM)

# Data and Code Statement {#sec:datastatement}
All code for reproducing the analyses in this paper is publicly available at https://github.com/Akhil-Ghosh/SticklebackProject
\textcolor{red}{Is this true? Matt's code is at this GitHub page? -YS}

# References {#sec:references}

# Supplementary Material {#sec:supplementary}
<!-- SCRAP CODE and TEXT. YS moved it down here on 21 October 2024 because it was making it hard for me to see the manuscript.  -->
<!-- THIS FIGURE DOESN'T SHOW MUCH. LET'S CUT FOR SPACE.  -->
```{r fig.cap = "Fossil sample size for each time period",include=FALSE}
ggplot(aes(x = time, y = count), data = fortab) + geom_col() + xlab("Sample")  + scale_x_continuous(breaks = 1:18, labels = 1:18)
```
<!-- I removed the table and replaced it with a figure -->
<!-- % latex table generated in R 4.2.2 by xtable 1.8-4 package -->
<!-- % Mon May  1 11:20:28 2023 -->
<!-- \begin{table}[ht] -->
<!-- \centering -->
<!-- \caption{The number of stickleback fossils at each time point.  Sample size at each time point ranges from a low of 22 to a high of 67.} -->
<!-- \begin{tabular}{rl} -->
<!--   \hline -->
<!-- time & count \\  -->
<!--   \hline -->
<!--   1 & 43 \\  -->
<!--     2 & 41 \\  -->
<!--     3 & 51 \\  -->
<!--     4 & 41 \\  -->
<!--     5 & 46 \\  -->
<!--     6 & 48 \\  -->
<!--     7 & 67 \\  -->
<!--     8 & 55 \\  -->
<!--     9 & 42 \\  -->
<!--    10 & 33 \\  -->
<!--    11 & 37 \\  -->
<!--    12 & 22 \\  -->
<!--    13 & 41 \\  -->
<!--    14 & 43 \\  -->
<!--    15 & 46 \\  -->
<!--    16 & 47 \\  -->
<!--    17 & 56 \\  -->
<!--    18 & 55 \\  -->
<!--    \hline -->
<!-- \end{tabular} -->
<!-- \label{tabn} -->

<!-- \end{table} -->


<!-- Within each trait, the model with the lowest DIC was chosen for that trait <THIS IS METHODS--WHERE IS THIS DESCRIBED IN THE METHODS>.  All subsequent results presented here use the model with the lowest DIC individually by trait <THIS IS METHODS--WHERE IS THIS DESCRIBED IN THE METHODS>.   -->

<!-- Table \ref{whichmodel} reports the results of model fitting.  X of the Y traits were best fit by a trend model. Best models included an OU component for caudal and abdominal vertebra number (mcv, mav), pelvic spine length (lpt <LPT IS PTERYGIOPHORE LENGTH>) and standard length (stl). Caudal vertebra number was the only trait best fit by a model including both a trend and an OU component.  This implies that not only does caudal vertebra size have a linear trend across sex <WHAT DO YOU MEAN BY LINEAR TREND ACROSS SEX?>, but the average size at one time period is highly correlated with the average size at the next time period <I'VE ALWAYS FOUND THAT THIS AID TO MODEL INTEPRETATION IS BETTER IN THE METHODS, JUST AFTER THE MODELS ARE DESCRIBED>. -->

<!-- \textcolor{red} { -->
<!-- Yoel's interpretation of the above paragraph. Taking the model with the lowest DIC score as the best model for each trait, we found that cle, ds1, lps, and pmx did not fit either the trend model or the OU model for male-female trait mean differences. In contrast, we found a trend through time in male-female trait mean differences (i.e., sexual dimorphism) for mcv, ds2, ds3, ect, maf, and mdf. This suggests that these traits changed their dimorphism from one time period to the next, with an overall tendency toward ???GREATER/LESS??? dimorphism. IS THIS CORRECT? - YS -->
<!-- } -->
<!-- \textcolor{red} { -->
<!-- We found evidence for an OU process but no trend for lpt, mav, and stl, suggesting that these traits varied through time, about a fixed value for dimorphism. Finally, we found evidence that change in mcv fitted both a trend an an OU process, meaning ??? WHAT BIOLOGICALLY ???. -->
<!-- } -->

<!-- \textcolor{red} {HOW DO WE RECONCILE THE PRESENCE OF TRENDS IN THESE MODELS WITH AN ABSENCE OF VISIBLE TRENDS IN FIGURES 2 THROUGH 4? I WONDER IF THIS RESULT PARAGRAPH BELONGS BEST AT THE END OF THE RESULTS, RATHER THAN THE BEGINNING. CONSIDER THE STATISTICAL EVIDENCE FOR TRENDS AND OU AFTER WE'VE WALKED THE READERS THROUGH VISUAL EVIDENCE FOR CHANGE. -->
<!-- } -->

<!-- ## Best fitting models  -->
<!-- \begin{table}[ht] -->
<!-- \centering -->
<!-- \begin{tabular}{|c||c|c|} -->
<!--   \hline -->
<!--  & OU & No OU  \\  -->
<!--   \hline -->
<!--   \hline -->
<!-- Trend  &  mcv  & ds2, ds3, ect, maf, mdf \\  -->
<!--   \hline -->
<!--   No Trend & lpt, mav, stl  &  cle, ds1, lps, pmx\\ -->
<!--    \hline -->
<!-- \end{tabular} -->
<!-- \label{whichmodel} -->
<!-- \end{table} -->


<!-- Trends terms included in were observed in ds2, ds3, ect, maf, mdf, mcv,  -->
<!-- OU term included in model: mcv, lpt, stl -->
<!-- model_list[["cle"]] <- 3 -->
<!-- model_list[["ds1"]] <- 3 -->
<!-- model_list[["ds2"]] <- 1 -->
<!-- model_list[["ds3"]] <- 1 -->
<!-- model_list[["ect"]] <- 1 -->
<!-- model_list[["lps"]] <- 3 -->
<!-- model_list[["lpt"]] <- 2 -->
<!-- model_list[["maf"]] <- 1 -->
<!-- model_list[["mav"]] <- 2 -->
<!-- model_list[["mcv"]] <- 0 -->
<!-- model_list[["mdf"]] <- 1 -->
<!-- #model_list[["mds"]] <- 3 -->
<!-- #model_list[["mpt"]] <- 0 -->
<!-- model_list[["pmx"]] <- 3 -->
<!-- model_list[["stl"]] <- 2 -->
<!-- #model_list[["tpg"]] <- 1 -->
<!-- Greg notes:  -->
<!-- - mdf and maf have interesting trends.   -->
<!-- - ds3 flips over time.  Females have larger values to start and over the course of the time frame wer are looking at males end up with larger mean values.   -->
<!-- - Most of the other traits have mean differences that are relatively constant over time.   -->

<!-- In our empirical study, we analyze the following four nested models for the mean process outlined in (\ref{eq:mu}): -->
<!-- \begin{itemize} -->
<!-- \item OU with Trend: The mean process for each phenotype $k=1,\cdots,K$ and $g \in \{f,m\}$ as previously defined. -->
<!-- \item OU with No Trend: No linear trend on the mean processes and the overall mean of the phenotype is constant for each sex. This is achieved by setting $\beta_{1,kg} = 0$ in (\ref{eq:mu}) for $k = 1,\cdots,K$ and $g \in \{f,m\}$ -->
<!-- \item No OU with Trend: No random fluctuations on the mean processes, i.e. the OU process assumption is not needed. This is achieved by setting $u_{k,gt_i} = 0$ in (\ref{eq:mu}) for $k = 1,\cdots,K$, $g \in \{f,m\}$, and $i = 1,\cdots,T$. -->
<!-- \item No OU with No Trend: The mean for a specific trait and specific sex at each time point is a constant value. This is achieved by setting $\beta_{1,kg} = 0$ and $u_{k,gt_i} = 0$ in (\ref{eq:mu}) for $k = 1,\cdots,K$, $g \in \{f,m\}$, and $i = 1,\cdots,T$. -->
<!-- \end{itemize} -->

<!-- Traits such as standard length (stl), anal fin ray (maf), dorsal fin ray (mdf), premaxilla (pmx), and dorsal spine 1 (ds1) demonstrate constant sexual dimorphism with all but the last having learger mean values in male sepcimen. Other traits such as abdominal vertebra (mav), caudal vertebra (mcv), and pelvic spine length (lps) don't appear to have any discernable sexual dimorphism in the means.  Dorsal spine 3 (ds3) exhibits sexual dimorphism that changes over time.  The mean number of dorsal spine 3 begins larger for females for the earliest observed time periods.  Over time, however, this switches and the male specimens exhibit larger mean values for the latest observed time periods.  -->

<!-- \textcolor{red} { -->
<!-- Yoel's interpretation of the three paragraphs above. Male and female G. doryssus differ for some traits, indicating detectable sexual dimorphism. This is evidenced by traits with substantial differences in male and female posterior means (i.e., deviation from 0 in Figure \ref{fig:mu-diff-plot}), supported by posterior probabilities that deviate from 0.5 (Figure \ref{fig:prob0-plot}). For example, males are larger than females by 3-8mm on average through time (stl panel in Figure \ref{fig:mu-diff-plot}), with a posterior probability for that mean difference above 70 percent through time (Figure \ref{fig:prob0-plot}). In contrast, the number of abdominal vertebrae (mav) fluctuates about 0 (Figure \ref{fig:mu-diff-plot}), with posterior probabilities fluctuating about 50 percent through time (Figure \ref{fig:prob0-plot}). Table \ref{tab:prob0-table} in the Supplementary Material summarizes the posterior probabilities that male means differ from female means by trait and sample. -->
<!-- } -->
<!-- The amount of sexual dimporphism over time does not change substantially for a majority of the trait observed here (i.e. cle, ds1, ds2, ect, lps, lpt, mav, mcv, pmx, stl).  Traits that trend away from the mean difference at the first observed time point include dorsal spine 3 (ds3), anal fin ray (maf), and dorsal fin ray (mdf).   -->

<!-- #ds3 -->
<!-- apply(mu_m,2,mean)[1] #2.291846 -->
<!-- apply(mu_f,2,mean)[1] #2.448115  -->
<!-- apply(mu_m,2,mean)[18] #1.264728  -->
<!--   apply(mu_f,2,mean)[18] #1.184534  -->
<!-- apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #-1.027118  -->
<!-- apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-1.263581  -->
<!-- The posterior mean of the mean number of dorsal spine rays at the first observed time point is 2.29 for males and for females it is 2.45.  At the last observed time point, the average number for males and female both dropped to 1.265 and 1.185 for males and females, respectively.  This resulted in a mean number of dorsal spine 3 lost by males of 1.027 and for females it was 1.264.  This resulted in a change of the mean difference from time point 1 to time point 18 of 0.236.  Basically, males and females both lowered the mean number of dorsal spine 3, but females lowered their mean more than the males.   -->

<!-- #maf -->
  <!-- apply(mu_m,2,mean)[1] #8.517534 -->
  <!-- apply(mu_f,2,mean)[1] #8.290749  -->
  <!-- apply(mu_m,2,mean)[18] #8.549155  -->
  <!-- apply(mu_f,2,mean)[18] #8.170195  -->
  <!-- apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #0.03162047  -->
  <!-- apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-0.1205537 -->
  <!-- (apply(mu_m,2,mean) - apply(mu_f,2,mean))[18] - (apply(mu_m,2,mean) - apply(mu_f,2,mean))[1] #0.1521742  -->
<!-- MAF: Number of bones in the anal fin posterior to the anal spine (i.e., softdorsal fin rays) -->

<!-- We also observed a change in the differences between males and females for the number of bones int he anal fin ray (maf) and the number of bones in the dorsal fin ray.  The difference in the means of males versus females for anal fin ray bones changed by 0.152 over the course of the observed time periods.  This change was driven mostly by the change in females.  At the first observed time period the had on average 8.291 bones dropping to 8.170 over the 18 times periods observed. Whereas for males the change in means rose only from  8.518 to 8.549, about 0.0316 bones on average.   -->

<!-- A similar change in the difference of the means over time was observed for the number of bones in the dorsal fin (mdf).  However, unlike maf, this change in sexual dimporhism was driven entirely by the males.  The mean change for females over the 18 observed time periods was only 0.0055 with the average number of dorsal fin bones for females starting at 9.287 and the final observed mean of 9.281 resulting in almost no change in the mean.  For males, the average number of dorsal fin bones at the first time point was about 9.568 dropping to 9.734 over the course of the observed time periods for a gain of 0.166 bones on average.   -->

<!-- #mdf -->
<!--   apply(mu_m,2,mean)[1] #9.567811  -->
<!--   apply(mu_f,2,mean)[1] #9.286521 -->
<!--   apply(mu_m,2,mean)[18] #9.733923 -->
<!--   apply(mu_f,2,mean)[18] #9.281005 -->
<!--   apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #0.1661123  -->
<!--   apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-0.005516126  -->
<!--   (apply(mu_m,2,mean) - apply(mu_f,2,mean))[18] - (apply(mu_m,2,mean) - apply(mu_f,2,mean))[1] #0.1716284 -->
<!-- MDF: Dorsal fin ray: Number of bones in the dorsal finposterior to the third dorsal spine (i.e.,soft dorsal fin rays. -->
 
<!-- \textcolor{red} { -->
<!-- Yoel's interpretation of the five paragraphs above.  -->
<!-- Figure \ref{fig:AUC-plot} shows the posterior probability that the mean male-female difference at time t is different from the male-female difference at time zero. In other words, Figure \ref{fig:AUC-plot} plots whether the sexual dimorphism changes in subsequent samples, always relative to the first sample. The amount of sexual dimporphism over time does not change substantially for a majority of the traits (i.e. cle, ds1, ds2, ect, lps, lpt, mav, mcv, pmx, stl; Figure \ref{fig:AUC-plot}). Traits that change in dimorphism are anal fin ray (maf), and dorsal fin ray (mdf), and dorsal spine 3 (ds3).} -->

<!-- \textcolor{red} { -->
<!-- For example, females at time zero averaged 8.29 rays in the anal fin, dropping to 8.17 rays in the final sample. Males averaged 8.52 anal fin rays in the first sample and 8.55 in the last sample. Thus, the difference between males and females started at 0.23 and ended at 0.38, an increase in sexual dimorphism. In contrast, the sign on dimorphism flipped for ds3. The posterior mean length of the third dorsal spine is 2.29mm for males and 2.45mm for females. By the end of the sequence, mean ds3 for males was 1.27 for males and 1.19 for females. Both sexes evolved reduction of ds3, but females lowered their mean more than the males. This resulted in a flip in dimorphism, from larger females to larger males, though both sexes evolved trait reduction. BUT DIMORPHISM SHRUNK THEN, AS THE DIFFERENCE BETWEEN MALES AND FEMALES IS NOW SMALLER?? -->
<!-- } -->



```{r echo = FALSE}
library(tidyverse)
library(ROCR)
model_list <- list()
#Indicate which model was used for each trai
model_list[["cle"]] <- 3
model_list[["ds1"]] <- 3
model_list[["ds2"]] <- 1
model_list[["ds3"]] <- 1
model_list[["ect"]] <- 1
model_list[["lps"]] <- 3
model_list[["lpt"]] <- 2
model_list[["maf"]] <- 1
model_list[["mav"]] <- 2
model_list[["mcv"]] <- 0
model_list[["mdf"]] <- 1
#model_list[["mds"]] <- 3
#model_list[["mpt"]] <- 0
model_list[["pmx"]] <- 3
model_list[["stl"]] <- 2
#model_list[["tpg"]] <- 1
library(here)
samps_stl <- readRDS(here("Figures/stl","posterior_samples_stl_2.RDS"))
mu_stl <- samps_stl %>% select(contains("mu"))
 maxtime <- 18
 results_prob_mu_diff_gt_mu_diff0 <- results_prob_mu_diff_gt_0 <- results_auc_mu_diff <-  data.frame()
phenotype <- "ds3"
  samps <- readRDS(here(paste0("Figures/",phenotype),paste0("posterior_samples_",phenotype,"_",model_list[[phenotype]],".RDS")))
  gamma <- samps %>% select(gamma)
  mu <- samps %>% select(contains("mu"))
  if (phenotype == "stl") {
    mu_f <-
      mu[, 1:maxtime]
    mu_m <-
      mu[, (maxtime + 1):(2 * maxtime)]
  } else {

    if (phenotype %in% c("mdf","maf","mav","mcv")){
      mu_f <-exp(mu[, 1:maxtime])
      mu_m <- exp(mu[, (maxtime + 1):(2 * maxtime)])

    } else {
      mu_f <-
        mu[, 1:maxtime] + as.data.frame(rep(gamma, 18)) * mu_stl[, 1:maxtime]
      mu_m <-
        mu[, (maxtime + 1):(2 * maxtime)] + as.data.frame(rep(gamma, 18)) * mu_stl[, (maxtime +
                                                                                        1):(2 * maxtime)]
    }



  }
  
  #ds3 
  # apply(mu_m,2,mean)[1] #2.291846
  # apply(mu_f,2,mean)[1] #2.448115 
  # 
  # apply(mu_m,2,mean)[18] #1.264728 
  # apply(mu_f,2,mean)[18] #1.184534 
  # 
  # apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #-1.027118 
  # apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-1.263581 
  # 
  # (apply(mu_m,2,mean) - apply(mu_f,2,mean))[18] - (apply(mu_m,2,mean) - apply(mu_f,2,mean))[1] #0.2364628
```

```{r echo = FALSE}
library(tidyverse)
library(ROCR)
model_list <- list()
#Indicate which model was used for each trai
model_list[["cle"]] <- 3
model_list[["ds1"]] <- 3
model_list[["ds2"]] <- 1
model_list[["ds3"]] <- 1
model_list[["ect"]] <- 1
model_list[["lps"]] <- 3
model_list[["lpt"]] <- 2
model_list[["maf"]] <- 1
model_list[["mav"]] <- 2
model_list[["mcv"]] <- 0
model_list[["mdf"]] <- 1
#model_list[["mds"]] <- 3
#model_list[["mpt"]] <- 0
model_list[["pmx"]] <- 3
model_list[["stl"]] <- 2
#model_list[["tpg"]] <- 1
library(here)
samps_stl <- readRDS(here("Figures/stl","posterior_samples_stl_2.RDS"))
mu_stl <- samps_stl %>% select(contains("mu"))
 maxtime <- 18
 results_prob_mu_diff_gt_mu_diff0 <- results_prob_mu_diff_gt_0 <- results_auc_mu_diff <-  data.frame()
phenotype <- "maf"
  samps <- readRDS(here(paste0("Figures/",phenotype),paste0("posterior_samples_",phenotype,"_",model_list[[phenotype]],".RDS")))
  gamma <- samps %>% select(gamma)
  mu <- samps %>% select(contains("mu"))
  if (phenotype == "stl") {
    mu_f <-
      mu[, 1:maxtime]
    mu_m <-
      mu[, (maxtime + 1):(2 * maxtime)]
  } else {

    if (phenotype %in% c("mdf","maf","mav","mcv")){
      mu_f <-exp(mu[, 1:maxtime])
      mu_m <- exp(mu[, (maxtime + 1):(2 * maxtime)])

    } else {
      mu_f <-
        mu[, 1:maxtime] + as.data.frame(rep(gamma, 18)) * mu_stl[, 1:maxtime]
      mu_m <-
        mu[, (maxtime + 1):(2 * maxtime)] + as.data.frame(rep(gamma, 18)) * mu_stl[, (maxtime +
                                                                                        1):(2 * maxtime)]
    }



  }
  
  # #maf
  # apply(mu_m,2,mean)[1] #8.517534
  # apply(mu_f,2,mean)[1] #8.290749 
  # 
  # apply(mu_m,2,mean)[18] #8.549155 
  # apply(mu_f,2,mean)[18] #8.170195 
  # 
  # apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #0.03162047 
  # apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-0.1205537
  # 
  # (apply(mu_m,2,mean) - apply(mu_f,2,mean))[18] - (apply(mu_m,2,mean) - apply(mu_f,2,mean))[1] #0.1521742 
```


```{r echo = FALSE}
library(tidyverse)
library(ROCR)
model_list <- list()
#Indicate which model was used for each trai
model_list[["cle"]] <- 3
model_list[["ds1"]] <- 3
model_list[["ds2"]] <- 1
model_list[["ds3"]] <- 1
model_list[["ect"]] <- 1
model_list[["lps"]] <- 3
model_list[["lpt"]] <- 2
model_list[["maf"]] <- 1
model_list[["mav"]] <- 2
model_list[["mcv"]] <- 0
model_list[["mdf"]] <- 1
#model_list[["mds"]] <- 3
#model_list[["mpt"]] <- 0
model_list[["pmx"]] <- 3
model_list[["stl"]] <- 2
#model_list[["tpg"]] <- 1
library(here)
samps_stl <- readRDS(here("Figures/stl","posterior_samples_stl_2.RDS"))
mu_stl <- samps_stl %>% select(contains("mu"))
 maxtime <- 18
 results_prob_mu_diff_gt_mu_diff0 <- results_prob_mu_diff_gt_0 <- results_auc_mu_diff <-  data.frame()
phenotype <- "mdf"
  samps <- readRDS(here(paste0("Figures/",phenotype),paste0("posterior_samples_",phenotype,"_",model_list[[phenotype]],".RDS")))
  gamma <- samps %>% select(gamma)
  mu <- samps %>% select(contains("mu"))
  if (phenotype == "stl") {
    mu_f <-
      mu[, 1:maxtime]
    mu_m <-
      mu[, (maxtime + 1):(2 * maxtime)]
  } else {

    if (phenotype %in% c("mdf","maf","mav","mcv")){
      mu_f <-exp(mu[, 1:maxtime])
      mu_m <- exp(mu[, (maxtime + 1):(2 * maxtime)])

    } else {
      mu_f <-
        mu[, 1:maxtime] + as.data.frame(rep(gamma, 18)) * mu_stl[, 1:maxtime]
      mu_m <-
        mu[, (maxtime + 1):(2 * maxtime)] + as.data.frame(rep(gamma, 18)) * mu_stl[, (maxtime +
                                                                                        1):(2 * maxtime)]
    }



  }
  
  #mdf
  # apply(mu_m,2,mean)[1] #9.567811 
  # apply(mu_f,2,mean)[1] #9.286521
  # 
  # apply(mu_m,2,mean)[18] #9.733923
  # apply(mu_f,2,mean)[18] #9.281005
  # 
  # apply(mu_m,2,mean)[18] - apply(mu_m,2,mean)[1] #0.1661123 
  # apply(mu_f,2,mean)[18] - apply(mu_f,2,mean)[1] #-0.005516126 
  # 
  # (apply(mu_m,2,mean) - apply(mu_f,2,mean))[18] - (apply(mu_m,2,mean) - apply(mu_f,2,mean))[1] #0.1716284
```








<!-- %- FINAL SUMMARY TABLES  -->
<!--  1. posterior probabilities of mu diff greter than 0. (sexual dimorphism) -->
<!--  2. Posterior probabilities of the difference in the distribution at time 0 and time 19.  (trends) -->
 
```{r echo = FALSE}
library(tidyverse)
library(ROCR)
model_list <- list()
#Indicate which model was used for each trai
model_list[["cle"]] <- 3
model_list[["ds1"]] <- 3
model_list[["ds2"]] <- 1
model_list[["ds3"]] <- 1
model_list[["ect"]] <- 1
model_list[["lps"]] <- 3
model_list[["lpt"]] <- 2
model_list[["maf"]] <- 1
model_list[["mav"]] <- 2
model_list[["mcv"]] <- 0
model_list[["mdf"]] <- 1
#model_list[["mds"]] <- 3
#model_list[["mpt"]] <- 0
model_list[["pmx"]] <- 3
model_list[["stl"]] <- 2
#model_list[["tpg"]] <- 1
library(here)
samps_stl <- readRDS(here("Figures/stl","posterior_samples_stl_2.RDS"))
mu_stl <- samps_stl %>% select(contains("mu"))
 maxtime <- 18
 results_posterior_mean_diff <- results_prob_mu_diff_gt_mu_diff0 <- results_prob_mu_diff_gt_0 <- results_auc_mu_diff <-  data.frame()
 
for (phenotype in names(model_list)){
  samps <- readRDS(here(paste0("Figures/",phenotype),paste0("posterior_samples_",phenotype,"_",model_list[[phenotype]],".RDS")))
  gamma <- samps %>% select(gamma)
  mu <- samps %>% select(contains("mu"))
  if (phenotype == "stl") {
    mu_f <-
      mu[, 1:maxtime]
    mu_m <-
      mu[, (maxtime + 1):(2 * maxtime)]
  } else {

    if (phenotype %in% c("mdf","maf","mav","mcv")){
      mu_f <-exp(mu[, 1:maxtime])
      mu_m <- exp(mu[, (maxtime + 1):(2 * maxtime)])

    } else {
      mu_f <-
        mu[, 1:maxtime] + as.data.frame(rep(gamma, 18)) * mu_stl[, 1:maxtime]
      mu_m <-
        mu[, (maxtime + 1):(2 * maxtime)] + as.data.frame(rep(gamma, 18)) * mu_stl[, (maxtime +
                                                                                        1):(2 * maxtime)]
    }



    }

  mu_diff <- mu_m - mu_f
  
  

  #Probability males are greater than females
  results_prob_mu_diff_gt_0 <- rbind(results_prob_mu_diff_gt_0,data.frame(
    phenotype = phenotype,
    time = 1:18,
    prob_mu_diff_gt_0 = apply(mu_diff, 2, function(x) {
      mean(x > 0)
    })
  ))

  #Differences in the distributions from time point 1 to time point 18
  auc_mu_diff <- c()
  for (j in 1:18){
  pred <- prediction(c(mu_diff[,1], mu_diff[,j]), rep(c(1,0), each = nrow(mu_diff)))
  auc_mu_diff[j] <- perf <- performance(pred, "auc")@y.values[[1]]
  }


  results_auc_mu_diff <- rbind(results_auc_mu_diff,data.frame(
    phenotype = phenotype,
    time = 1:18,
    auc_mu_diff = auc_mu_diff
    ))



  prob_mu_diff_gt_mu_diff0 <- c()
  for (j in 1:18){
    prob_mu_diff_gt_mu_diff0[j] <- mean(sample(mu_diff[,1],10000, replace = TRUE) >= sample(mu_diff[,j],10000, replace = TRUE))

  }


  results_prob_mu_diff_gt_mu_diff0 <- rbind(results_prob_mu_diff_gt_mu_diff0,data.frame(
    phenotype = phenotype,
    time = 1:18,
    prob_mu_diff_gt_mu_diff0 = prob_mu_diff_gt_mu_diff0
  ))
  
  
  results_posterior_mean_diff <- rbind( results_posterior_mean_diff,data.frame(
    phenotype = phenotype,
    time = 1:18,
    mu_diff = apply(mu_diff,2,mean)
  ))

  # plot(perf,
  #      avg= "threshold",
  #      colorize=TRUE,
  #      lwd= 3,
  #      main= "With ROCR you can produce standard plots\nlike ROC curves ...")
  # plot(perf,
  #      lty=3,
  #      col="black",
  #      add=TRUE)
  #


}



# ggplot(aes(x = time, y = auc_mu_diff), data = results_auc_mu_diff) + facet_wrap(~phenotype) + geom_path() +  geom_path() + geom_hline(yintercept = 0.5, lty = 3) + ylim(0,1)
# ggplot(aes(x = time, y = prob_mu_diff_gt_mu_diff0), data = results_prob_mu_diff_gt_mu_diff0) + facet_wrap(~phenotype) + geom_path() +  geom_path() + geom_hline(yintercept = 0.5, lty = 3)
#ggplot(aes(x = time, y = prob_mu_diff_gt_0), data = results_prob_mu_diff_gt_0) + facet_wrap(~phenotype) + geom_path() + geom_hline(yintercept = 0.5, lty = 3) + ylim(0,1)


#Now make some tables.
#Rows are traits.


```

```{r prob0-table, echo = FALSE, tab.cap= "Posterior probability that the mean for males is larger than the mean for females",include=FALSE}
#Which model was used
mod_df <- data.frame(phenotype = names(unlist(model_list)), mod = unlist(model_list))
mod_code <- data.frame(mod = 0:3, mod_name = c("OU-Trend","No OU-Trend",
                                               "OU-No Trend","NO OU-No Trend"))
results_prob_mu_diff_gt_0_table <- results_prob_mu_diff_gt_0 %>%  mutate(prob_mu_diff_gt_0 = round(prob_mu_diff_gt_0,3)) %>% pivot_wider(names_from = "phenotype", values_from = "prob_mu_diff_gt_0")
library(xtable)
xtable(results_prob_mu_diff_gt_0_table)
```


```{r auc-table, echo = FALSE, tab.cap= "AUC comparing time x versus time 0.",include=FALSE}
results_auc_mu_diff_table <- results_auc_mu_diff %>%  mutate(auc_mu_diff = round(auc_mu_diff,3)) %>% pivot_wider(names_from = "phenotype", values_from = "auc_mu_diff")
#library(xtable)
xtable(results_auc_mu_diff_table)
#knitr::kable(results_auc_mu_diff_table, caption = "The mtcars data.")
```



<!-- posterior mean difference for males versus females (values above 0 indicate means that were greater for males versus females) -->




```{r mu-diff-plot, echo = FALSE, fig.cap = "Posterior mean difference between males and females, in UNITS?. Values above 0 indicate larger male means",include=FALSE}
ggplot(aes(x = time, y = mu_diff), data = results_posterior_mean_diff) + facet_wrap(~phenotype, scale = "free_y") + geom_path() + geom_hline(yintercept = 0, lty = 3) + ylab("Posterior Mean Difference")
```

```{r prob0-plot, echo = FALSE, fig.cap = "Posterior probabilities that the male posterior mean is larger than the female posterior mean",include=FALSE}
ggplot(aes(x = time, y = prob_mu_diff_gt_0), data = results_prob_mu_diff_gt_0) + facet_wrap(~phenotype) + geom_path() + #geom_hline(yintercept = 0, lty = 3) + ylim(0,1) + ylab("Posterior Probability") Why yintercept in 0 and not 0.5?
geom_hline(yintercept = 0.5, lty = 3) + ylim(0,1) + ylab("Posterior Probability")
```

```{r AUC-plot, echo = FALSE, fig.cap= "The Posterior Probability that male-female differences in subsequent samples are different from male-female differenceds in the initial sample. Values near 0.5 indicate little difference between the distributions. Values closer to 0 indicate that the difference in means has shifted towards larger means in females. Values closer to 1 indicate that the difference in means has shifted toward larger means in males.",include=FALSE}
ggplot(aes(x = time, y = auc_mu_diff), data = results_auc_mu_diff) + facet_wrap(~phenotype) + geom_path() +  geom_path() + geom_hline(yintercept = 0.5, lty = 3) + ylim(0,1) + ylab("Posterior Probability")
```

<!-- # Figures -->
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("cle"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/cle","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("ds1"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/ds1","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("ds2"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/ds2","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("ds3"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/ds3","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("ect"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/ect","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("lps"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/lps","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("lpt"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/lpt","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("maf"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/maf","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("mav"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/mav","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("mcv"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/mcv","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("mdf"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/mdf","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("mds"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/mds","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("mpt"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/mpt","lambda_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("pmx"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/pmx","mu_diff.pdf"))
```
```{r, out.width="0.9\\linewidth", include=TRUE, fig.align="center", fig.cap=c("stl"), echo=FALSE, include = FALSE}
knitr::include_graphics(here("Figures/stl","mu_diff.pdf"))
```
