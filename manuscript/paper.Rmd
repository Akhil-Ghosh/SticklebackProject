---
title: |
  |  \Large Stickle!
author: | 
  | \large Matthew Stuart \vspace{-1.1mm}
  | \normalsize Department of Mathematics and Statistics \vspace{-1mm}
  | \normalsize Loyola University Chicago \vspace{-1mm}
  | \normalsize Chicago, IL 60660 \vspace{-1mm}
  | \normalsize [`mstuart@luc.edu`](mailto:mstuart@luc.edu) \vspace{-1mm}
  |
  | \large Akhil Ghosh \vspace{-1.1mm}
  | \normalsize Department of Mathematics and Statistics \vspace{-1mm}
  | \normalsize Loyola University Chicago \vspace{-1mm}
  | \normalsize Chicago, IL 60660 \vspace{-1mm}
  | \normalsize [`aghosh@luc.edu`](mailto:aghosh@luc.edu) \vspace{-1mm}
  |
  | \large Yoel Stuart \vspace{-1.1mm}
  | \normalsize Department of Biology \vspace{-1mm}
  | \normalsize Loyola University Chicago \vspace{-1mm}
  | \normalsize Chicago, IL 60660 \vspace{-1mm}
  | \normalsize [`ystuart@luc.edu`](mailto:ystuart@luc.edu) \vspace{-1mm}
  |
  | \large Gregory J. Matthews \vspace{-1.1mm}
  | \normalsize Department of Mathematics and Statistics \vspace{-1mm}
  | \normalsize Loyola University Chicago \vspace{-1mm}
  | \normalsize Chicago, IL 60660 \vspace{-1mm}
  | \normalsize [`gmatthews1@luc.edu`](mailto:gmatthews1@luc.edu) \vspace{-1mm}
abstract: |
  | Evewryone loves the stickle \vspace{2mm}
  | *Keywords*: Stickle
bibliography: references.bib
fontsize: 12pt
link-citations: true
linkcolor: cyan
urlcolor: cyan
output:
  pdf_document:
    df_print: kable
    number_sections: true
    keep_tex: true
header-includes:
 \usepackage{setspace}
 \setstretch{1.15}
 \usepackage{float}
 \floatplacement{figure}{t}
---

```{r setup, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	fig.align = "center",
	message = FALSE,
	warning = FALSE
)

gjm <- function(x, color = "red") {
  sprintf("\\textcolor{%s}{%s}", color, x)}
```

```{r pkgs}
library(tidyverse)
theme_set(theme_minimal())
library(Lahman)
```

\newpage

# Introduction {#sec:intro}
Sexual Dimorphism is interesting because...... 

Sexual Dimoprhism lit review:
@SaittaEtAl2020 

Studying sexual dimorphism of phenotypes in modern species is a straightforward endeavor: measure a phenotype of interest and statistically test for differences between the sexes.  However, examining sexual dimorphism in fossils is complicated substantially by the issue that sex may not be able to be directly observed from fossil specimens.  For this study, we have two sources of data: 1) Modern stickleback specimens with observed sex and 2) fossil specimens with sex unobserved.  We view the sex of the fossils as missing data and use multiple imputation (@little2002statistical) to impute the sex of the fossils using the modern stickleback fish with observed sex to model the relationship between sex and observed phenotypes.  Once sex is imputed, an Ornsteinâ€“Uhlenbeck (OU) model is fit using a Bayesian framework to look for sexual dimorphism across a variety of stickleback phenotypes (e.g. length, vertebrae count?, etc).

The remainder of this manuscript contains a description of the data in section \ref{sec:data} and a description of our models in \ref{sec:models}. Section \ref{sec:results} presents a summary of our results, and we end with our conclusion and future work in section \ref{sec:conclusions}.  

# Data {#sec:data}

```{r}
stickle <- read_csv('stickle_revamped.csv')

stick <- stickle %>% 
  mutate(gender = as.factor(case_when(
    grepl(".M.",univID,fixed=TRUE) ~ "Male",
    grepl(".F.",univID,fixed=TRUE) ~ "Female",
    grepl("Fos",univID,fixed=TRUE) ~ NA_character_
    )), ips = as.factor(ips)
  ) %>% 
  select(gender, everything())

#getting time vector, adding it to imputed data
univ <- stick %>% 
  mutate(time = as.integer(sub(".*([0-9]{2})\\..*", "\\1",univID)))
times <- univ %>% drop_na(time) %>% pull(time)

times_vector <- c(rep(1,43)) %>% 
  append(21-times)

#fossil n
fortab <- data.frame(time = 1:18, count = as.character(as.numeric((table(times_vector)))))
#knitr::kable(fortab)
#print(xtable(fortab),include.rownames = FALSE)
```

The data used here consists of a total of `r sum(!is.na(stick$gender))` extant specimens with known sex all collected in the last 30 years.  Of these, there are `r sum(stick$gender == "Female",na.rm = TRUE)` and `r sum(stick$gender == "Male",na.rm = TRUE)` female and male specimens, respectively.  

In addition there are `r sum(is.na(stick$gender))` fossil specimens from approximately 10.3 million years ago with unknown sex over 18 time periods spaced about 1000 years apart. Table 1 shows the sample size at each of the 18 time periods.  There are at least 22 specimens at each time period with a high of 67 specimens in period 7.  


<!-- % latex table generated in R 4.2.2 by xtable 1.8-4 package -->
<!-- % Mon May  1 11:20:28 2023 -->
\begin{table}[ht]
\centering
\begin{tabular}{rl}
  \hline
time & count \\ 
  \hline
  1 & 43 \\ 
    2 & 41 \\ 
    3 & 51 \\ 
    4 & 41 \\ 
    5 & 46 \\ 
    6 & 48 \\ 
    7 & 67 \\ 
    8 & 55 \\ 
    9 & 42 \\ 
   10 & 33 \\ 
   11 & 37 \\ 
   12 & 22 \\ 
   13 & 41 \\ 
   14 & 43 \\ 
   15 & 46 \\ 
   16 & 47 \\ 
   17 & 56 \\ 
   18 & 55 \\ 
   \hline
\end{tabular}
<!-- \label{tab1} -->
\caption{The number of stickleback fossils at each time point.  Sample size at each time point ranges from a low of 22 to a high of 67.}
\end{table}


What covariates do we have in the data: length, what else, 



# Models  {#sec:models}
## Imputation model 
Let $W$ be sex and $X$ are covariates.  This data set up here is $n_{fossil} + n_{modern}$.  
$W = (W_{obs},W_{mis})$ where $W_{obs}$ and $W_{mis}$ are the observed and missing parts of the covariate sex.  In this setting, $W_{obs}$ perfectly corresponds to the sex of the modern specimens, and $W_{mis}$ perfectly corresponds to the fossil data.  Missing values of sex are imputed by drawing from the posterior predictive distribution $P(W_{mis}|W_{obs}, X)$. Multiple imputation was implemented here using MICE (CITE) with predictive mean matching.  The data were imputed M = 100 times.  

## OU model 
After imputing sex, we fit an OU model for different phenotypes of interest. We only look at $n_{fossil}$ fossil observations.  
WLOG we choose one of the columns of $X$ to be the target ophenotype and our analysis is repeated for all phenotypes of interest.  

Let $X_{gti}$ be a phenotype of interest for the $i$-th observation $i = 1\ldots,n_{tg}$, in sex $g = 1, 2$ and $t = 1, \ldots, 18$.   


$$
X_{gti} \sim N(\mu_{gt}, \sigma^2)\\

\mu_{gt} \sim \kappa \mu_{g(t-1)} + (1-\kappa)\theta_g + \nu_{gt}\\

\nu_{gt} \sim N(0,\tau^2)\\
$$
Priors: 
$$
\sigma^2 \sim Scaled-Inv \chi^2(1)\\
\tau^2 \sim Scaled-Inv \chi^2(1)\\

\mu_{g0} \sim N(0,10000000000000), g = 1,2\\


\kappa \sim N(0,10000000000)\\
\theta \sim N(0,10000000000) \\

$$

All models were built using @R2022language

@Cornault2022 Bayesian OU model.  

Bayesian Analysis after multiple imputation @ZhouReiter2009: They recommend using a large number of imputrations.  5 or 10 is too small.  We are using M = 100.  


# Results {#sec:results}

# Future work and conclusions {#sec:conclusions}


# Acknowledgements {-}


Stickle!

# Supplementary Material {-}

All code for reproducing the analyses in this paper is publicly available at https://github.com/Akhil-Ghosh/SticklebackProject

# References
